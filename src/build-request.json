{
  "kind": "build_request",
  "title": "Make contact form WhatsApp delivery automatic and ensure chat opens after submit",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-1",
      "text": "Update the Contact page submission flow so that after a successful contact form submission, a WhatsApp chat is automatically opened (in a new tab/window) using the same prefilled message currently generated by `formatContactFormMessage(...)` and sent to `siteConfig.whatsapp.contactFormNumber`. Keep the existing post-success WhatsApp button as a fallback if the popup/new tab is blocked.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "no chat open on your WhatsApp when testing the form myself"
        ]
      },
      "acceptanceCriteria": [
        "Submitting the contact form successfully triggers an attempt to open the WhatsApp deep link in a new tab/window.",
        "If the browser blocks the popup/new tab, the UI still shows a visible WhatsApp button/link the user can click to open WhatsApp manually.",
        "The prefilled text in the opened WhatsApp chat matches the formatted message produced by the existing helper (includes Name, Email, Phone, Message).",
        "The WhatsApp target number used is `siteConfig.whatsapp.contactFormNumber` (no hardcoded numbers)."
      ]
    },
    {
      "id": "REQ-2",
      "text": "Implement automated WhatsApp message delivery that does not depend on the visitor pressing \"Send\" in WhatsApp by adding a server-side notification step when a contact form submission is created. The backend must, upon submission, call a configurable external WhatsApp messaging provider (e.g., WhatsApp Business API provider) via HTTPS to send the same formatted message to the owner/operator number automatically.",
      "target": "both",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "adjust the system so that messages reach you automatically without depending on the user pressing Send"
        ]
      },
      "acceptanceCriteria": [
        "On each successful contact form submission, the backend initiates an outbound HTTPS request to a configurable provider endpoint to send a WhatsApp message containing all submitted contact details.",
        "If the provider call fails, the contact submission is still stored in the canister (no data loss), and the frontend shows an English error/notice indicating the WhatsApp notification could not be sent automatically.",
        "Provider configuration (at minimum: API base URL/endpoint, auth token/key, and destination WhatsApp/owner number) is not hardcoded in the UI; it is configurable (admin-controlled or deploy-time configuration).",
        "Automated sending uses the same message content structure currently used for the WhatsApp deep link (Name/Email/Phone/Message in a clear format)."
      ]
    },
    {
      "id": "REQ-3",
      "text": "Add backend/admin-safe observability for automated WhatsApp notifications by recording, per contact submission, whether an automated WhatsApp send was attempted and whether it succeeded (including a timestamp and a short status/error string). Expose this information only to admins when retrieving submissions.",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-1"
        ],
        "quotes": [
          "messages reach you automatically"
        ]
      },
      "acceptanceCriteria": [
        "Each stored contact submission has associated notification status metadata (attempted/succeeded/failed + timestamps and error text when applicable).",
        "Only admin callers can retrieve notification status metadata (non-admin/public callers cannot access it).",
        "Admin retrieval (`getAllContactSubmissions`) returns submissions sorted as before and includes the additional notification status fields or a parallel structure that can be correlated per submission."
      ]
    }
  ],
  "constraints": [
    "Backend must remain a single Motoko actor in backend/main.mo (no additional backend services).",
    "Do not edit any files under frontend/src/components/ui or any path listed in frontend immutablePaths.",
    "Use English for any user-facing text.",
    "Keep the existing WhatsApp deep-link formatting behavior intact; automated sending should reuse the same content structure."
  ],
  "nonGoals": [
    "Building a full third-party authentication system (only Internet Identity is supported).",
    "Implementing real-time chat or WebSocket-based delivery status updates.",
    "Integrating unsupported backend stacks or external databases."
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  },
  "userProfileUpdate": {
    "goalsToAdd": [],
    "goalsToRemove": [],
    "preferencesToAdd": [],
    "preferencesToRemove": [],
    "miscToAdd": [],
    "miscToRemove": [],
    "fieldsToSet": {},
    "fieldsToDelete": []
  }
}